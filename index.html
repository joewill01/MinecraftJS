<!DOCTYPE html>
<html>
	<head>
		<meta charset="utf-8">
		<title>My first three.js app</title>
		<style>
			body { margin: 0; }
			canvas { display: block; }
		</style>
	</head>
	<body>
		<script src="js/three.js"></script>
		<script>
			var scene = new THREE.Scene();
			var camera = new THREE.PerspectiveCamera( 75, window.innerWidth / window.innerHeight, 0.1, 1000 );
			camera.position.set(0,2,2);

			var renderer = new THREE.WebGLRenderer();
			renderer.setSize( window.innerWidth, window.innerHeight );
			document.body.appendChild( renderer.domElement );

			class Block {
				constructor(x,y,z,texture) {
					this.x = x;
					this.y = y;
					this.z = z;
					this.texture_name = texture;
					this.height = 1;
					this.width = 1;
					this.depth = 1;

					this.texture = new THREE.TextureLoader().load(`textures/${this.texture_name}`);
					this.geometry = new THREE.BoxBufferGeometry(this.height,this.width,this.depth);
					this.material = new THREE.MeshBasicMaterial( {map: this.texture} );
					this.cube = new THREE.Mesh( this.geometry, this.material );
					this.cube.position.x = this.x;
					this.cube.position.y = this.y;
					this.cube.position.z = this.z;
					scene.add( this.cube );
				}
			}

			let blocks = [];

			for (let x = -20; x < 20; x++) {
				for (let z = -20; z < 20; z++) {
					blocks.push(new Block(x, Math.floor(Math.random() * Math.floor(3)), z, 'dirt.jpg'))
				}
			}

			document.addEventListener('keydown', keyDownHandler, false);
			document.addEventListener('keyup', keyUpHandler, false);

			function keyDownHandler(event) {
				if (event.keyCode === 87) {
					// w
					cameraSpeedForward = 0.1;
				} if (event.keyCode === 65) {
					// a
					cameraSpeedSide = -0.1;
				} if (event.keyCode === 83) {
					// s
					cameraSpeedForward = -0.1;
				} if (event.keyCode === 68) {
					// d
					cameraSpeedSide = 0.1;
				} if (event.keyCode === 32) {
					// space
					cameraSpeedUp = 0.11;
				} if (event.keyCode === 83) {
					// l shift
				}
			}

			function keyUpHandler(event) {
				if (event.keyCode === 87) {
					// w
					cameraSpeedForward = 0;
				} if (event.keyCode === 65) {
					// a
					cameraSpeedSide = 0;
				} if (event.keyCode === 83) {
					// s
					cameraSpeedForward = 0;
				} if (event.keyCode === 68) {
					// d
					cameraSpeedSide = 0;
				} if (event.keyCode === 32) {
					// space
				} if (event.keyCode === 83) {
					// l shift
				}
			}

			window.addEventListener('mousemove', e => {
				camera.rotation.y = - ((e.clientX - (window.innerWidth/2)) / (window.innerWidth/2) * 360) * Math.PI / 180;
				//camera.rotation.x = - ((e.clientY - (window.innerHeight/2)) / (window.innerHeight/2) * 70) * Math.PI / 180;
			});

			let cameraAccelerationForward = 0;
			let cameraAccelerationSide = 0;
			let cameraAccelerationUp = -0.006;

			let cameraSpeedForward = 0;
			let cameraSpeedSide = 0;
			let cameraSpeedUp = 0;

			function moveCamera() {
				cameraSpeedForward += cameraAccelerationForward;
				cameraSpeedSide += cameraAccelerationSide;
				cameraSpeedUp += cameraAccelerationUp;

				let direction = new THREE.Vector3;
				camera.getWorldDirection(direction);
				let sideDirection = {'x': direction['z'], 'y': 0, 'z': direction['x']};
				direction = {'x': direction['x'], 'y': 0, 'z': direction['z']};

    			camera.position.addScaledVector(direction, cameraSpeedForward);
				camera.position.addScaledVector(sideDirection, cameraSpeedSide);

				if (camera.position.y + cameraSpeedUp <= 2) {
					camera.position.y = 2;
				} else {
					camera.position.y += cameraSpeedUp;
				}
			}

			function animate() {
				moveCamera();
				requestAnimationFrame( animate );
				renderer.render( scene, camera );
			}
			animate();
		</script>
	</body>
</html>